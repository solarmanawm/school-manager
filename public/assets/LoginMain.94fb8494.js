import{d as h,u as V,r as i,a as x,c as b,b as a,w as t,e as k,o as f,f as S,g as w,t as A,h as C,i as N,s as T,j as q,k as o}from"./index.1e5e80b3.js";import{u as B,r as c,e as E,_ as U,a as d}from"./AppFormGroup.57537ecc.js";import{_ as j}from"./AppButton.b4ec5f9d.js";import{A as p}from"./AppControl.684aaebb.js";import{_ as z}from"./AppCard.3ad22048.js";import{_ as F}from"./AppAlert.0560d307.js";const M={class:"w-full flex-1 flex items-center justify-center"},P=w("Sign In "),J=h({__name:"LoginMain",setup(D){const _=k(),$=V(),l=i({type:"error",message:""}),u=x(!1),m=i({username:"",password:""}),e=B({username:{required:c,email:E,$lazy:!0},password:{required:c,$lazy:!0}},m),g=()=>{e.value.username.$model="",e.value.password.$model="",e.value.$reset()},v=s=>{if(s.name)if(s.name==="AxiosError"){const{message:r}=s.response.data;l.message=r,g()}else console.warn(s.message);else console.error(s)},y=()=>(u.value=!0,e.value.$validate().then(s=>{if(s)return T.auth.login({username:m.username,password:m.password});throw new Error("Form is not valid.")}).then(s=>(l.type="success",l.message="You've successfully signed in into your account.",new Promise(r=>{setTimeout(()=>{r(void 0)},1e3)}).then(()=>{$.updateAuthState(!0,s.accessToken,s.refreshToken)}).then(()=>_.push({name:q.dashboard})))).catch(v).finally(()=>{u.value=!1}));return(s,r)=>(f(),b("div",M,[a(z,{class:"sm:max-w-sm"},{default:t(()=>[l.message?(f(),S(F,{key:0,type:l.type},{default:t(()=>[w(A(l.message),1)]),_:1},8,["type"])):C("",!0),a(U,{onSubmit:r[2]||(r[2]=N(n=>y(),["prevent"]))},{default:t(()=>[a(d,{class:"w-full",label:"Username",for:"username",required:!0,errors:o(e).username.$errors},{default:t(()=>[a(p,{modelValue:o(e).username.$model,"onUpdate:modelValue":r[0]||(r[0]=n=>o(e).username.$model=n),error:o(e).username.$error,class:"w-full",id:"username"},null,8,["modelValue","error"])]),_:1},8,["errors"]),a(d,{class:"w-full",label:"Password",for:"password",required:!0,errors:o(e).password.$errors},{default:t(()=>[a(p,{modelValue:o(e).password.$model,"onUpdate:modelValue":r[1]||(r[1]=n=>o(e).password.$model=n),error:o(e).password.$error,type:"password",class:"w-full",id:"password"},null,8,["modelValue","error"])]),_:1},8,["errors"]),a(d,{class:"w-full"},{default:t(()=>[a(j,{loading:u.value,type:"submit",class:"w-full"},{default:t(()=>[P]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]))}});export{J as default};
