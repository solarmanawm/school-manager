import{d as le,$ as oe,a as F,l as d,n as ne,c as T,b as i,w as o,f as v,k as e,S as O,F as ie,e as re,j as N,a0 as ue,o as m,Q as de,a1 as me,Y as fe,g as c,t as y,i as S,D as h,h as ve,s as V}from"./index.1e5e80b3.js";import{_ as A,V as $}from"./AppButton.b4ec5f9d.js";import{b as I,a as U,u as j,_ as q,c as ce}from"./index.6f7326c6.js";import{_ as B,a as R}from"./AppFormGroup.57537ecc.js";import{A as b,T as Y}from"./AppControl.684aaebb.js";const pe=["onClick"],De={key:1,class:"text-center"},Ee={class:"w-full flex items-center justify-between"},ye=c("Cancel "),Ve={key:1,class:"text-center"},Ae={class:"w-full flex items-center justify-between"},Re=c("Cancel ");var P=(a=>(a.ADD="ADD",a.EDIT="EDIT",a.REMOVE="REMOVE",a))(P||{}),z=(a=>(a.ADD="ADD",a.RESET="RESET",a))(z||{}),H=(a=>(a.ADD="Create a new family",a.EDIT="Edit the family",a.REMOVE="Remove the family",a))(H||{}),L=(a=>(a.ADD="Add an income",a.RESET="Reset this income",a))(L||{}),Q=(a=>(a.ADD="Create",a.EDIT="Save",a.REMOVE="Remove",a))(Q||{}),W=(a=>(a.ADD="Add",a.RESET="Reset",a))(W||{});const he=le({__name:"FamiliesMain",setup(a){const _=oe(),k=re();F([]);const M=ce(),w=F(!1),X=d(()=>l.fields.fees.value.length),G=d(()=>w.value?"Unselect All":"Select All"),g=d(()=>_.fees.map(s=>({value:s.id,title:s.name}))),J=d(()=>_.fees.length>0),K=()=>{l.fields.fees.value=w.value?[]:g.value.map(s=>s.value)},Z=d(()=>{const s={};return k.currentRoute.value.name===N.families&&(s.add=C.add),k.currentRoute.value.name===N.family&&(s.income=x.add,s.resetIncome=x.reset),s}),ee=d(()=>H[r.value()]),te=d(()=>Q[r.value()]),l=I({initialValues:{id:"",name:"",description:"",fees:[]},validation:{name:{required:!0},description:{pattern:s=>s===""||/^[\u0401\u0451\u0410-\u044fa-z0-9,.\s]+$/i.test(s)}},validationMessages:{description:{pattern:"Description should contain alphabetic characters and digits only."}},onValidated:()=>new Promise(s=>{const t=l.values(),{id:E}=t;r.is("ADD")&&V.family.create(t).then(s),r.is("EDIT")&&V.family.update(t).then(s),r.is("REMOVE")&&V.family.delete(E.toString()).then(s)}).then(p.close),onError:M}),r=U(P,()=>{r.is()&&p.open()}),p=j({onClose:()=>{r.reset(),l.reset()}}),C={add:()=>{r.set("ADD")},edit:s=>{const t=_.getFamilyById(s);t&&(l.fields.id.value=t.id,l.fields.name.value=t.name,l.fields.description.value=t.description,l.fields.fees.value=t.fees),r.set("EDIT")},remove:s=>{l.fields.id.value=s,r.set("REMOVE")}},se=d(()=>L[u.value()]),ae=d(()=>W[u.value()]),f=I({initialValues:{amount:""},validation:{amount:{required:!0,integer:!0}},onValidated:()=>new Promise(s=>{const{id:t}=l.values(),{amount:E}=f.values();u.is("ADD")&&V.family.income(t,+E).then(s),u.is("RESET")&&V.family.resetIncome(t).then(s)}).then(D.close),onError:M}),u=U(z,()=>{u.is()&&D.open()}),D=j({onClose:()=>{u.reset(),l.reset(),f.reset()}}),x={add:s=>{l.fields.id.value=s,u.set("ADD")},reset:s=>{l.fields.id.value=s,u.set("RESET")}};return ne(X,s=>{w.value=s===g.value.length}),(s,t)=>{const E=ue("router-view");return m(),T(ie,null,[i(E,null,{default:o(({Component:n})=>[(m(),v(fe(n),de({onEdit:C.edit,onRemove:C.remove},me(e(Z))),null,16,["onEdit","onRemove"]))]),_:1}),(m(),v(O,{to:"#app-popup"},[i(q,{visible:e(p).visible.value,"onUpdate:visible":t[6]||(t[6]=n=>e(p).visible.value=n)},{title:o(()=>[c(y(e(ee)),1)]),content:o(()=>[e(r).is("ADD")||e(r).is("EDIT")?(m(),v(B,{key:0,onSubmit:t[3]||(t[3]=S(()=>{},["prevent"])),class:"mb-0"},{default:o(()=>[i(R,{class:"w-full",label:"Name",target:"Name",required:!0,errors:e(l).errors.name.value},{default:o(()=>[i(b,{modelValue:e(l).fields.name.value,"onUpdate:modelValue":t[0]||(t[0]=n=>e(l).fields.name.value=n),error:e(l).errors.name.value.length>0,class:"w-full",id:"name"},null,8,["modelValue","error"])]),_:1},8,["errors"]),e(J)?(m(),v(R,{key:0,class:"w-full",label:"Fees",target:"fees"},{context:o(()=>[h("a",{href:"#",onClick:S(K,["prevent"]),class:"text-blue-500 hover:text-blue-700 underline decoration-dashed hover:no-underline"},y(e(G)),9,pe)]),default:o(()=>[i(b,{modelValue:e(l).fields.fees.value,"onUpdate:modelValue":t[1]||(t[1]=n=>e(l).fields.fees.value=n),type:e(Y).DROPDOWN,options:e(g),multiple:!0,id:"fees",class:"w-full"},null,8,["modelValue","type","options"])]),_:1})):ve("",!0),i(R,{class:"w-full",label:"Description",target:"description",errors:e(l).errors.description.value},{default:o(()=>[i(b,{modelValue:e(l).fields.description.value,"onUpdate:modelValue":t[2]||(t[2]=n=>e(l).fields.description.value=n),class:"w-full",id:"description",type:e(Y).TEXTAREA,error:e(l).errors.description.value.length>0},null,8,["modelValue","type","error"])]),_:1},8,["errors"])]),_:1})):(m(),T("p",De,"Are you sure you want to remove this family?"))]),footer:o(()=>[h("div",Ee,[i(A,{onClick:t[4]||(t[4]=n=>e(p).close()),variant:e($).SECONDARY},{default:o(()=>[ye]),_:1},8,["variant"]),i(A,{onClick:t[5]||(t[5]=n=>e(l).submit(!e(r).is("REMOVE")))},{default:o(()=>[c(y(e(te)),1)]),_:1})])]),_:1},8,["visible"])])),(m(),v(O,{to:"#app-popup"},[i(q,{visible:e(D).visible.value,"onUpdate:visible":t[11]||(t[11]=n=>e(D).visible.value=n)},{title:o(()=>[c(y(e(se)),1)]),content:o(()=>[e(u).is("ADD")?(m(),v(B,{key:0,onSubmit:t[8]||(t[8]=S(()=>{},["prevent"])),class:"mb-0"},{default:o(()=>[i(R,{class:"w-full",label:"Amount",target:"amount",required:!0,errors:e(f).errors.amount.value},{default:o(()=>[i(b,{modelValue:e(f).fields.amount.value,"onUpdate:modelValue":t[7]||(t[7]=n=>e(f).fields.amount.value=n),error:e(f).errors.amount.value.length>0,class:"w-full",id:"amount"},null,8,["modelValue","error"])]),_:1},8,["errors"])]),_:1})):(m(),T("p",Ve,"Are you sure you want to reset this family's income?"))]),footer:o(()=>[h("div",Ae,[i(A,{onClick:t[9]||(t[9]=n=>e(D).close()),variant:e($).SECONDARY},{default:o(()=>[Re]),_:1},8,["variant"]),i(A,{onClick:t[10]||(t[10]=n=>e(f).submit(!e(u).is("RESET")))},{default:o(()=>[c(y(e(ae)),1)]),_:1})])]),_:1},8,["visible"])]))],64)}}});export{he as default};
