import{_ as A,d as $,u as V,a as x,r as i,b,c as k,e as a,w as t,o as p,f as S,g as w,t as C,h as B,i as F,s as M,j as N,k as o}from"./index.93ca6e21.js";import{u as P,r as c,e as T,A as j,a as d}from"./AppFormGroup.6dd6e794.js";import{A as q}from"./AppButton.b0f6ca87.js";import{A as f}from"./AppControl.932a4855.js";import{A as E}from"./AppCard.1307c386.js";import{A as L}from"./AppAlert.f0eb5ddf.js";const U={class:"w-full flex-1 flex items-center justify-center"},z=w("Sign In "),D=$({__name:"LoginMain",setup(G){const g=V(),v=x(),l=i({type:"error",message:""}),u=b(!1),m=i({username:"",password:""}),e=P({username:{required:c,email:T,$lazy:!0},password:{required:c,$lazy:!0}},m),_=()=>{e.value.username.$model="",e.value.password.$model="",e.value.$reset()},h=s=>{if(s.name)if(s.name==="AxiosError"){const{message:r}=s.response.data;l.message=r,_()}else console.warn(s.message);else console.error(s)},y=()=>(u.value=!0,e.value.$validate().then(s=>{if(s)return M.auth.login({username:m.username,password:m.password});throw new Error("Form is not valid.")}).then(s=>(l.type="success",l.message="You've successfully signed in into your account.",new Promise(r=>{setTimeout(()=>{r(void 0)},1e3)}).then(()=>{v.updateAuthState(!0,s.accessToken,s.refreshToken)}).then(()=>g.push({name:N.dashboard})))).catch(h).finally(()=>{u.value=!1}));return(s,r)=>(p(),k("div",U,[a(E,{class:"sm:max-w-sm"},{default:t(()=>[l.message?(p(),S(L,{key:0,type:l.type},{default:t(()=>[w(C(l.message),1)]),_:1},8,["type"])):B("v-if",!0),a(j,{onSubmit:r[2]||(r[2]=F(n=>y(),["prevent"]))},{default:t(()=>[a(d,{class:"w-full",label:"Username",for:"username",required:!0,errors:o(e).username.$errors},{default:t(()=>[a(f,{modelValue:o(e).username.$model,"onUpdate:modelValue":r[0]||(r[0]=n=>o(e).username.$model=n),error:o(e).username.$error,class:"w-full",id:"username"},null,8,["modelValue","error"])]),_:1},8,["errors"]),a(d,{class:"w-full",label:"Password",for:"password",required:!0,errors:o(e).password.$errors},{default:t(()=>[a(f,{modelValue:o(e).password.$model,"onUpdate:modelValue":r[1]||(r[1]=n=>o(e).password.$model=n),error:o(e).password.$error,type:"password",class:"w-full",id:"password"},null,8,["modelValue","error"])]),_:1},8,["errors"]),a(d,{class:"w-full"},{default:t(()=>[a(q,{loading:u.value,type:"submit",class:"w-full"},{default:t(()=>[z]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]))}});var O=A(D,[["__file","/home/dmitry/PhpstormProjects/school-manager-web/src/frontend/components/LoginMain.vue"]]);export{O as default};
