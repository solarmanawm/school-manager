import{d as j,$ as H,a as y,l as u,n as L,c as T,b as n,w as i,f,k as e,S as P,F as Q,e as W,a0 as z,o as d,Q as G,a1 as J,j as K,Y as Z,g as w,t as _,i as A,D as C,h as ee,s as g}from"./index.1e5e80b3.js";import{_ as R,V as le}from"./AppButton.b4ec5f9d.js";import{u as ae,a as se,b as te,_ as re,c as oe}from"./index.6f7326c6.js";import{A as v,T as p}from"./AppControl.684aaebb.js";import{_ as ie,a as c}from"./AppFormGroup.57537ecc.js";const ne=["onClick"],ue={key:1,class:"text-center"},de={class:"w-full flex items-center justify-between"},me=w("Cancel ");var b=(s=>(s.ADD="ADD",s.EDIT="EDIT",s.REMOVE="REMOVE",s))(b||{}),h=(s=>(s.ADD="Create a new fee",s.EDIT="Edit the fee",s.REMOVE="Remove the fee",s))(h||{}),M=(s=>(s.ADD="Create",s.EDIT="Save",s.REMOVE="Remove",s))(M||{});const De=j({__name:"FeesMain",setup(s){const k=W(),E=H(),D=y(!1);y([]);const F=oe(),O=u(()=>a.fields.families.value.length),x=u(()=>D.value?"Unselect All":"Select All"),I=u(()=>M[r.value()]),N=u(()=>h[r.value()]),V=u(()=>E.families.map(t=>({value:t.id,title:t.name}))),$=u(()=>E.families.length>0),q=()=>new Promise(t=>{const l=a.values();if(r.is("ADD"))return g.fee.create(l).then(t);if(r.is("EDIT"))return g.fee.update(l).then(t);if(r.is("REMOVE"))return g.fee.delete(l.id).then(t)}).then(m.close),m=ae({onClose:()=>{r.reset(),a.reset()}}),r=se(b,()=>{r.is()&&m.open()}),a=te({initialValues:{id:"",name:"",value:"",description:"",families:[],completed:!1},validation:{name:{required:!0},value:{required:!0,integer:!0},description:{}},validationMessages:{name:{required:"Please, enter a name."},value:{required:"You need to define a fee amount."}},onValidated:q,onError:F}),S=()=>{r.set("ADD")},U=t=>{const l=E.getFeeById(t);l&&(a.fields.id.value=l.id,a.fields.name.value=l.name,a.fields.value.value=l.value,a.fields.description.value=l.description,a.fields.completed.value=l.completed,a.fields.families.value=l.families),r.set("EDIT")},B=t=>{a.fields.id.value=t,r.set("REMOVE")},X=()=>{a.fields.families.value=D.value?[]:V.value.map(t=>t.value)};return L(O,t=>{D.value=t===V.value.length}),(t,l)=>{const Y=z("router-view");return d(),T(Q,null,[n(Y,null,{default:i(({Component:o})=>[(d(),f(Z(o),G({onEdit:U,onRemove:B},J(e(k).currentRoute.value.name===e(K).fees?{add:S}:{})),null,16))]),_:1}),(d(),f(P,{to:"#app-popup"},[n(re,{visible:e(m).visible.value,"onUpdate:visible":l[7]||(l[7]=o=>e(m).visible.value=o)},{title:i(()=>[w(_(e(N)),1)]),content:i(()=>[e(r).is("ADD")||e(r).is("EDIT")?(d(),f(ie,{key:0,onSubmit:l[4]||(l[4]=A(()=>{},["prevent"])),class:"mb-0"},{default:i(()=>[n(c,{class:"w-full",label:"Name",target:"name",required:!0,errors:e(a).errors.name.value},{default:i(()=>[n(v,{modelValue:e(a).fields.name.value,"onUpdate:modelValue":l[0]||(l[0]=o=>e(a).fields.name.value=o),class:"w-full",id:"name",type:e(p).TEXT,error:e(a).errors.name.value.length>0},null,8,["modelValue","type","error"])]),_:1},8,["errors"]),n(c,{class:"w-full",label:"Value",target:"value",required:!0,errors:e(a).errors.value.value},{default:i(()=>[n(v,{modelValue:e(a).fields.value.value,"onUpdate:modelValue":l[1]||(l[1]=o=>e(a).fields.value.value=o),class:"w-full",id:"value",type:e(p).TEXT,error:e(a).errors.value.value.length>0},null,8,["modelValue","type","error"])]),_:1},8,["errors"]),e($)?(d(),f(c,{key:0,class:"w-full",label:"Families",target:"families"},{context:i(()=>[C("a",{href:"#",onClick:A(X,["prevent"]),class:"text-blue-500 hover:text-blue-700 underline decoration-dashed hover:no-underline"},_(e(x)),9,ne)]),default:i(()=>[n(v,{modelValue:e(a).fields.families.value,"onUpdate:modelValue":l[2]||(l[2]=o=>e(a).fields.families.value=o),type:e(p).DROPDOWN,options:e(V),multiple:!0,id:"families",class:"w-full"},null,8,["modelValue","type","options"])]),_:1})):ee("",!0),n(c,{class:"w-full",label:"Description",target:"description",errors:e(a).errors.description.value},{default:i(()=>[n(v,{modelValue:e(a).fields.description.value,"onUpdate:modelValue":l[3]||(l[3]=o=>e(a).fields.description.value=o),class:"w-full",id:"description",type:e(p).TEXTAREA,error:e(a).errors.description.value.length>0},null,8,["modelValue","type","error"])]),_:1},8,["errors"])]),_:1})):(d(),T("p",ue,"Are you sure you want to remove this fee?"))]),footer:i(()=>[C("div",de,[n(R,{onClick:l[5]||(l[5]=o=>e(m).close()),variant:e(le).SECONDARY},{default:i(()=>[me]),_:1},8,["variant"]),n(R,{onClick:l[6]||(l[6]=o=>e(a).submit(!e(r).is("REMOVE")))},{default:i(()=>[w(_(e(I)),1)]),_:1})])]),_:1},8,["visible"])]))],64)}}});export{De as default};
