import{_ as U,d as q,b as P,u as j,a0 as G,l as m,a1 as H,c as h,e as o,w as i,f,k as e,S as Y,F as $,o as u,Q as K,a2 as L,j as A,Y as Q,g as E,t as _,i as W,h as z,D as J,s as c}from"./index.93ca6e21.js";import{A as X,a as p}from"./AppFormGroup.6dd6e794.js";import{A as v,T as D}from"./AppControl.932a4855.js";import{a as Z,b as ee,u as te,A as ae,c as se}from"./index.706a5033.js";import{V as B,A as R}from"./AppButton.b0f6ca87.js";const le={key:1,class:"text-center"},re={class:"w-full flex items-center justify-between"},oe=E("Cancel ");var b=(s=>(s.ADD="ADD",s.EDIT="EDIT",s.REMOVE="REMOVE",s))(b||{}),g=(s=>(s.ADD="Create a new student",s.EDIT="Edit the student",s.REMOVE="Remove the student",s))(g||{}),x=(s=>(s.ADD="Create",s.EDIT="Save",s.REMOVE="Remove",s))(x||{});const ie=q({__name:"StudentsMain",setup(s){P([]);const C=se(),y=j(),V=G(),O=m(()=>V.families.map(n=>({value:n.id,title:n.name}))),w=m(()=>O.value.length>0),M=()=>new Promise(n=>{const t=a.values();l.is("ADD")&&c.student.create(t).then(n),l.is("EDIT")&&c.student.update(t).then(n),l.is("REMOVE")&&c.student.delete(t.id).then(n)}).then(d.close),l=Z(b,()=>{l.is()&&d.open()}),a=ee({initialValues:{id:"",sex:"male",name:"",family:"",dateOfBirth:""},validation:{name:{required:!0},family:{required:!0},dateOfBirth:{required:!0}},onValidated:M,onError:C}),d=te({onClose:()=>{l.reset(),a.reset()}}),T=m(()=>g[l.value()]),I=m(()=>x[l.value()]),N=()=>{l.set("ADD")},S=n=>{const t=V.getStudentById(n);t&&(a.fields.id.value=t.id,a.fields.name.value=t.name,a.fields.sex.value=t.sex,a.fields.dateOfBirth.value=t.dateOfBirth,a.fields.family.value=t.family),l.set("EDIT")},k=n=>{l.set("REMOVE")};return(n,t)=>{const F=H("router-view");return u(),h($,null,[o(F,null,{default:i(({Component:r})=>[(u(),f(Q(r),K({onEdit:S,onRemove:k},e(y).currentRoute.value.name===e(A).students?{hasFamilies:e(w)}:{},L(e(y).currentRoute.value.name===e(A).students?{add:N}:{})),null,16))]),_:1}),(u(),f(Y,{to:"#app-popup"},[o(ae,{visible:e(d).visible.value,"onUpdate:visible":t[7]||(t[7]=r=>e(d).visible.value=r)},{title:i(()=>[E(_(e(T)),1)]),content:i(()=>[e(l).is("ADD")||e(l).is("EDIT")?(u(),f(X,{key:0,onSubmit:t[4]||(t[4]=W(()=>{},["prevent"])),class:"mb-0"},{default:i(()=>[e(w)?(u(),f(p,{key:0,class:"w-full",label:"Family",target:"family",required:!0,errors:e(a).errors.family.value},{default:i(()=>[o(v,{modelValue:e(a).fields.family.value,"onUpdate:modelValue":t[0]||(t[0]=r=>e(a).fields.family.value=r),class:"w-full",id:"family",type:e(D).DROPDOWN,error:e(a).errors.family.value.length>0,options:e(O)},null,8,["modelValue","type","error","options"])]),_:1},8,["errors"])):z("v-if",!0),o(p,{class:"w-full",label:"Name",target:"Name",required:!0,errors:e(a).errors.name.value},{default:i(()=>[o(v,{modelValue:e(a).fields.name.value,"onUpdate:modelValue":t[1]||(t[1]=r=>e(a).fields.name.value=r),error:e(a).errors.name.value.length>0,class:"w-full",id:"name"},null,8,["modelValue","error"])]),_:1},8,["errors"]),o(p,{class:"w-full",label:"Date of birth",target:"dateOfBirth",errors:e(a).errors.dateOfBirth.value},{default:i(()=>[o(v,{modelValue:e(a).fields.dateOfBirth.value,"onUpdate:modelValue":t[2]||(t[2]=r=>e(a).fields.dateOfBirth.value=r),error:e(a).errors.dateOfBirth.value.length>0,type:e(D).DATE_PICKER,class:"w-full",id:"dateOfBirth"},null,8,["modelValue","error","type"])]),_:1},8,["errors"]),o(p,{class:"w-full",label:"Sex",target:"sex"},{default:i(()=>[o(v,{modelValue:e(a).fields.sex.value,"onUpdate:modelValue":t[3]||(t[3]=r=>e(a).fields.sex.value=r),class:"w-full",id:"sex",type:e(D).BUTTON_SET,variant:e(B).LIGHT,options:[{title:"Male",value:"male"},{title:"Female",value:"female"}]},null,8,["modelValue","type","variant"])]),_:1})]),_:1})):(u(),h("p",le,"Are you sure you want to remove this student?"))]),footer:i(()=>[J("div",re,[o(R,{onClick:t[5]||(t[5]=r=>e(d).close()),variant:e(B).SECONDARY},{default:i(()=>[oe]),_:1},8,["variant"]),o(R,{onClick:t[6]||(t[6]=r=>e(a).submit(!e(l).is("REMOVE")))},{default:i(()=>[E(_(e(I)),1)]),_:1})])]),_:1},8,["visible"])]))],64)}}});var pe=U(ie,[["__file","/home/dmitry/PhpstormProjects/school-manager-web/src/frontend/components/StudentsMain.vue"]]);export{pe as default};
